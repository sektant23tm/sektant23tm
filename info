1. <Функциональный блок 1. Требования к созданию/изменению бизнес-сущностей> - Чикуридис А
2. <Функциональный блок 2. Требования к созданию и изменению бизнес-функций
3. <Функциональный блок 3. Требования к созданию/изменению Web-интерфейсов> - Чикуридис А
4. <Функциональный блок 4. Требования к изменению отчетов>
5. <Функциональный блок 5. Требования к созданию/изменению привилегий> - Чикуридис А.





2.10 <Требования к изменению функции "Создание корректировок">
Код: wms.whs_op_utils.create_income_ops_import
// суть изменений - в функции создания корректировок передаем не операцию, а задание приемки. Цену ТПО определяем позже, когда определим операцию

Инициация запуска:
  После нажатия в МРМП на "Завершить приемку", из функции "Завершение задания приемки"
Входные данные:
  ИД задания приемки
Логика работы:
  Получаем по заданию операцию и ее тип // line 2302
    По заданию из БС Связи операций с заданиями получить операции, где Тип связи = I
    По заданию получить ИД сотрудника
    По операциям получить:
      Уникальный тип операции // по операциям всегда должен быть один тип операции
  Если тип операции не импорт, межскладская накладная, приход, приход*нмц, приход*нмц вк, выходим
  Иначе:
    Формировать записи вида: ИД товара - Кол-во брака - Суммарное кол-во товара в паллетах задания - Цена ТПО // цена по ТПО может быть разной, возьмем ее позже
    По каждой записи:
      Запустить функцию Создание корректировок (недовоз/перевоз), на вход передать Суммарное кол-во товара в паллетах задания, ИД сотрудника, ИД товара, ИД операции задания приемки, Цену ТПО
      Если Кол-во брака больше или равно 0.000001, то:
        Если тип операции = Приход (без подтипа), то:
          Выводить пользователю ошибку: "Принимать брак для данного типа прихода запрещено."
        Иначе:
          Если Кол-во брака превышает кол-во (факт), то:
            Выводить пользователю ошибку: "Кол-во брака не может превышать факт"
          Иначе:
        Запустить функцию Создание корректировок (брак), на вход передать Кол-во брака, ИД сотрудника, ИД товара, ИД операции задания приемки, Цену ТПО
Выходные данные:
Без изменений






2.12 <Требования к изменению функции "Расчет кол-ва по ТПО">
// суть изменений - рассчитываем суммарное кол-во ТП в операциях с общим заданием приемки
Код: wms.whs_op_utils.calc_op_art_real_quant

Инициация запуска:
  Из функции Создание корректировок Недовоз/Перевоз
Входные данные:
  ИД ТПЗ
Логика работы:
  По ИД ТПЗ определить ИД задания и ИД товара
  По ИД задания в БС Связи операций с заданиями найти операции, где Тип связи = I
  По операциям найти ТПО, где ИД товара = ИД товара и получить суммарное Количество по ТПО
  По операциям найти записи в БС Корректировки, где ИД товара = ИД товара И SIGNTYPE = 1-Увеличивать, получить суммарное Количество увеличения
  По операциям найти записи в БС Корректировки, где ИД товара = ИД товара И SIGNTYPE = 2-Уменьшать, получить суммарное Количество уменьшения
  Кол-во по ТПО = Количество по ТПО - Количество уменьшения + Количество увеличения
Выходные данные:
  Кол-во по ТПО
